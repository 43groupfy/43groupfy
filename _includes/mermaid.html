
<!--
  Add Mermaid Support 

  v0.1
  https://github.com/s0ubhik/jekyll-theme-chirpy
  Â© 2020 Soubhik Biswas
  MIT License
-->
{%- if content contains 'class="mermaid"' -%}
  <script src="/assets/js/mermaid.min.js"></script>
  <script>mermaid.initialize({startOnLoad:false});</script>
<script>
class _mermaid{constructor(Class){if(Class==undefined)Class="mermaid";this.graphs=[];let mrmds=document.getElementsByClassName(Class);this.mrmds=mrmds;let graps=[];for(let i=0;i<mrmds.length;i++){let mrmd=mrmds[i];let ID="Mermaid-"+i;let graph=mrmd.innerText;mrmd.setAttribute("id",ID);this.graphs.push({id:ID,graph:graph})}}
async clean(){for(let i=0;i<this.mrmds.length;i++){if(this.mrmds[i].getAttribute("id")==this.graphs[i].id){this.mrmds[i].innerText=this.graphs[i].graph;this.mrmds[i].removeAttribute("data-processed")}}}
async render(init){await this.clean();if(init==null)init={};mermaid.initialize(init);mermaid.init(init,this.mrmds)}}  
</script>
  <script>
    Mermaid_settings = {
      "light" : {%- if site.mermaid.theme.light -%} "{{ site.mermaid.theme.light }}" {%- else -%} "default"{%- endif %},
      "dark" : {%- if site.mermaid.theme.dark -%} "{{ site.mermaid.theme.dark }}" {%- else -%} "dark"{%- endif %}
    };
    $(document).ready(function(){
    	Mermaid = new _mermaid();
    	if (toggle.hasMode){  /* Set as session */
    		Mermaid.render({theme: Mermaid_settings[toggle.mode]})
    	} else{
    	  if (toggle.isSysDarkPrefer){  /* Set as System */
    		Mermaid.render({theme: Mermaid_settings.dark});
    	  } else {
    		Mermaid.render({theme: Mermaid_settings.light});
    	  }
    	}
    	});

    $(".mode-toggle").click(function(){
    	Mermaid.render({theme: Mermaid_settings[toggle.mode]})
    });

  </script>
{%- endif %}
