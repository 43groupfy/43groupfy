<!--
  Switch the mode between dark and light.

  v2.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  Â© 2020 Cotes Chung
  MIT License
-->

<i class="mode-toggle fas fa-adjust"></i>

<script type="text/javascript">

  class ModeToggle {

    constructor() {
      this.dark_mode = "dark";
      this.light_mode = "light";
      this.mode_key = "mode";
 
      if (this.mode == null){ /* set as system */
        if (this.isSysDarkPrefer) {
          this.setDark();
        } else {
          this.setLight();
        }
      } else { /* Set as session */
        if (this.mode == this.dark_mode) this.setDark();
        if (this.mode == this.light_mode) this.setLight();
      }

      var self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addListener(function() {
        if (self.mode != null) {
          if (self.mode == this.dark_mode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }
      });

    } /* constructor() */


    setDark() {
      $('html').attr(this.mode_key, this.dark_mode);
      sessionStorage.setItem(this.mode_key, this.dark_mode);
    }

    setLight() {
      $('html').attr(this.mode_key, this.light_mode);
      sessionStorage.setItem(this.mode_key, this.light_mode);
    }

    clearMode() {
      $('html').removeAttr(this.mode_key);
      sessionStorage.removeItem(this.mode_key);
     }

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode == this.dark_mode; }

    get isLight_Mode() { return this.mode == this.light_mode; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(this.mode_key); }

    flipMode() {
      if (this.hasMode) {
        if (this.mode == this.dark_mode){
          this.clearMode();
          this.setLight();
        } else {
          this.clearMode();
          this.setDark();
        }
      }
    } /* flipMode() */

  } /* this */

  let toggle = new ModeToggle();

  $(".mode-toggle").click(function() {
    toggle.flipMode();
  });

</script>
